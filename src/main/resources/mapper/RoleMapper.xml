<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lifuyi.dev_monitor.dao.RoleMapper">

    <select id="getRoleByName" resultType="com.lifuyi.dev_monitor.model.role.Role">
        select * from role where role_name=#{role_name} and enterprise_id=#{enterprise_id}
    </select>

    <insert id="insertOrUpdateRole" parameterType="com.lifuyi.dev_monitor.model.role.Role">
        insert into role(id,role_name,status,create_time,update_time,enterprise_id)
        values (#{id},#{role_name},#{status},#{create_time},#{update_time},#{enterprise_id})
        ON DUPLICATE KEY UPDATE
        role_name=#{role_name},status=#{status},create_time=#{create_time},update_time=#{update_time},enterprise_id=#{enterprise_id}
    </insert>

    <select id="getRoleList" parameterType="com.lifuyi.dev_monitor.model.role.Role"
            resultType="com.lifuyi.dev_monitor.model.role.Resp.RoleResp">
         select id,role_name,status,create_time,update_time,r.enterprise_id,
         (select enterprise_name from enterprise_info where enterprise_id=r.enterprise_id) enterprise_name
          from role r where 1=1
          <if test="id!=null">
             and id=#{id}
          </if>
          <if test="role_name!=null">
              and role_name like concat('%',#{role_name},'%')
          </if>
          <if test="enterprise_id!=null">
              and enterprise_id=#{enterprise_id}
          </if>
          <if test="status!=null">
              and status=#{status}
          </if>
    </select>

    <delete id="deleteAuthorityByRoleId">
        delete from role_authority where role_id=#{role_id}
    </delete>

    <insert id="insertOrUpdateRoleAuthority" parameterType="com.lifuyi.dev_monitor.model.role.RoleAuthority">
        insert into role_authority(id,role_id,farm_id,shop_id,enterprise_id) values (#{id},#{role_id},#{farm_id},#{shop_id},#{enterprise_id})
        ON DUPLICATE KEY UPDATE
        role_id=#{role_id},farm_id=#{farm_id},shop_id=#{shop_id},enterprise_id=#{enterprise_id}
    </insert>

    <select id="getShopIdsByRoleId" resultType="string">
        select shop_id from role_authority where role_id=#{roleId}
    </select>

</mapper>